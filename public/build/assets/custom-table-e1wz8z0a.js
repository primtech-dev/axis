class k{constructor(t,s){this.table=t,this.parentInstance=s,this.thead=t.querySelector("thead"),this.tbody=t.querySelector("tbody"),this.headers=[],this.thead&&(this.headers=Array.from(this.thead.querySelectorAll("th"))),this.rows=Array.from(this.tbody.querySelectorAll("tr")),this.filteredRows=[...this.rows],this.rowsPerPage=parseInt(t.getAttribute(this.parentInstance.rowsPerPageAttribute)??this.parentInstance.rowsPerPage),this.currentPage=this.parentInstance.currentPage,this.checkAllCheckBox=null,this.searchInput=null,this.pagination=null,this.paginationInfo=null,this.filters=[],this.rangeFilters=[],this.itemNotFoundMessage="Nothing found.",this.deleteRowMessage="Are you sure you want to delete this row?",this.deleteMultipleRowsMessage="Are you sure you want to delete these rows?"}get totalPages(){return Math.ceil(this.filteredRows.length/this.rowsPerPage)||1}init(){this.setupCheckAll(),this.setupCheckboxListeners(),this.setupSearch(),this.headers.length>0&&(this.setupFilters(),this.setupSort()),this.setupRowsPerPage(),this.setupPagination(),this.setupPaginationInfo(),this.deleteSelected(),this.deleteRow(),this.update()}setupCheckAll(){this.thead&&(this.checkAllCheckBox=this.thead.querySelector(this.parentInstance.checkAllSelector),this.checkAllCheckBox&&this.checkAllCheckBox.addEventListener("click",t=>{const s=this.rows.map(e=>e.querySelector('input[type="checkbox"]'));s&&s.length>0&&s.forEach(e=>e.checked=t.target.checked)}))}setupCheckboxListeners(){const t=this.table.querySelectorAll('input[type="checkbox"]');this.checkAllCheckBox&&t.length>0&&t.forEach(s=>{s.addEventListener("change",()=>{const e=Array.from(t).some(n=>n.checked);this.deleteSelectedSelector&&this.filteredRows.length>0&&this.deleteSelectedSelector.classList.toggle("d-none",!e)})})}setupSearch(){this.searchInput=this.table.querySelector(this.parentInstance.searchSelector),this.searchInput&&this.searchInput.addEventListener("keyup",t=>{const s=t.target.value.toLowerCase();this.filteredRows=this.rows.filter(e=>Array.from(e.querySelectorAll("td")).some(a=>a.textContent.toLowerCase().includes(s))),this.currentPage=1,this.update()})}setupFilters(){this.filters=Array.from(this.table.querySelectorAll(this.parentInstance.filterSelector)),this.filters.forEach(t=>{t.addEventListener("change",()=>{this.applyFilters(),this.currentPage=1,this.update()})}),this.rangeFilters=Array.from(this.table.querySelectorAll(this.parentInstance.rangeFilterSelector)),this.rangeFilters.forEach(t=>{t.addEventListener("change",()=>{this.applyFilters(),this.currentPage=1,this.update()})})}applyFilters(){const t=e=>this.filters.every(n=>{const a=n.value;if(!a||a==="All")return!0;const o=n.dataset.tableFilter,c=this.headers.findIndex(g=>g.dataset.column===o);if(c===-1)return!0;const h=e.children[c];return h?h.textContent.trim().toLowerCase()===a.toLowerCase():!0}),s=e=>this.rangeFilters.every(n=>{const a=n.value;if(!a||a==="All")return!0;const o=n.dataset.tableRangeFilter,c=this.headers.findIndex(l=>l.dataset.column===o);if(c===-1)return!0;const h=e.children[c];if(!h)return!0;const g=h.textContent.trim();if(o.toLowerCase().includes("date")){const l=new Date(g);if(isNaN(l.getTime()))return!1;const i=new Date,d=new Date(i.getFullYear(),i.getMonth(),i.getDate()),r=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1);let p,f;switch(a){case"Today":return l>=d&&l<r;case"Last 7 Days":return p=new Date(i),p.setDate(i.getDate()-7),f=r,l>=p&&l<f;case"Last 30 Days":return p=new Date(i),p.setDate(i.getDate()-30),f=r,l>=p&&l<f;case"This Year":return p=new Date(i.getFullYear(),0,1),f=new Date(i.getFullYear()+1,0,1),l>=p&&l<f;default:return!0}}else{const l=parseFloat(g.replace(/[^\d.-]/g,""));if(isNaN(l))return!1;if(a.endsWith("+")){const r=parseFloat(a.slice(0,-1));return l>=r}const[i,d]=a.split("-").map(r=>parseFloat(r.trim()));return isNaN(i)||isNaN(d)?!1:l>=i&&l<=d}});this.filteredRows=this.rows.filter(e=>t(e)&&s(e))}setupRowsPerPage(){const t=this.table.querySelector(this.parentInstance.rowsPerPageSelector);if(t){const s=Array.from(t.options).map(e=>parseInt(e.value));s.includes(this.rowsPerPage)||s.push(this.rowsPerPage),s.sort((e,n)=>e-n),t.innerHTML="",s.forEach(e=>{const n=document.createElement("option");n.value=e.toString(),n.textContent=e.toString(),t.appendChild(n)}),t.value=this.rowsPerPage,t.addEventListener("change",e=>{e.preventDefault(),this.rowsPerPage=parseInt(e.target.value),this.update()})}}setupPagination(){this.pagination=this.table.querySelector(this.parentInstance.paginationSelector)}renderTablePage(t){this.tbody.innerHTML="";const s=(t-1)*this.rowsPerPage,e=s+this.rowsPerPage,n=this.filteredRows.slice(s,e),a=this.tbody.querySelector(".no-results");if(a&&a.remove(),n.length===0){const o=this.table.querySelectorAll("thead th").length,c=document.createElement("tr");c.className="no-results",c.innerHTML=`<td colspan="${o}" class="text-center text-muted py-3">${this.itemNotFoundMessage}</td>`,this.tbody.appendChild(c)}else n.forEach(o=>{this.tbody.appendChild(o)})}renderPagination(){const t=document.createElement("ul");t.className="pagination pagination-boxed mb-0 justify-content-center",this.pagination.innerHTML="";const s=this.totalPages,e=document.createElement("li");e.className=`page-item ${this.currentPage===1?"disabled":""}`,e.innerHTML='<a href="#" class="page-link"><i class="ti ti-chevron-left"></i></a>',e.addEventListener("click",a=>{a.preventDefault(),this.currentPage>1&&(this.currentPage--,this.update())}),t.appendChild(e);for(let a=1;a<=s;a++){const o=document.createElement("li");o.className=`page-item ${this.currentPage===a?"active":""}`,o.innerHTML=`<a href="#" class="page-link">${a}</a>`,o.addEventListener("click",c=>{c.preventDefault(),this.currentPage=a,this.update()}),t.appendChild(o)}const n=document.createElement("li");n.className=`page-item ${this.currentPage===s?"disabled":""}`,n.innerHTML='<a href="#" class="page-link"><i class="ti ti-chevron-right"></i></a>',n.addEventListener("click",a=>{a.preventDefault(),this.currentPage<this.totalPages&&(this.currentPage++,this.update())}),t.appendChild(n),this.pagination.appendChild(t),this.setupPaginationInfo()}setupPaginationInfo(){if(this.paginationInfo=this.table.querySelector(this.parentInstance.paginationInfoSelector),this.paginationInfo){this.paginationInfo.className="text-muted";const t=this.paginationInfo.getAttribute(this.parentInstance.paginationInfoAttribute),s=(this.currentPage-1)*this.rowsPerPage+1,e=Math.min(this.currentPage*this.rowsPerPage,this.filteredRows.length);this.paginationInfo.innerHTML=`Showing <span class="fw-semibold">${s}</span> to <span class="fw-semibold">${e}</span> of <span class="fw-semibold">${this.filteredRows.length}</span> ${t&&t!==""?t:"entries"}`}}update(){if(this.renderTablePage(this.currentPage),this.pagination){const t=this.filteredRows.length>0;this.pagination.style.display=t?"block":"none",this.paginationInfo&&(this.paginationInfo.style.display=t?"block":"none"),t&&this.renderPagination()}}setupSort(){this.table.querySelectorAll(this.parentInstance.sortSelector).forEach(s=>{s.style.cursor="pointer";let e=s.querySelector("i");e||(e=document.createElement("i"),e.className="ti ti-arrows-sort fs-xs ms-1",s.appendChild(e)),s.addEventListener("click",n=>{n.preventDefault();const a=Array.from(s.parentElement.children).indexOf(s);if(a===-1)return;const o=s.getAttribute(this.parentInstance.sortAttribute),h=s.dataset.direction==="asc"?"desc":"asc";s.dataset.direction=h,h==="asc"?e.className="ti ti-arrow-up fs-xs ms-1":e.className="ti ti-arrow-down fs-xs ms-1";function g(m,l,i){var S;const d=m.children[l];if(!d)return"";let r="";if(i){const u=d.querySelector(`[data-sort="${i}"]`);r=u?u.textContent.trim():""}else{const u=Array.from(d.childNodes).find(w=>w.nodeType===Node.TEXT_NODE&&w.textContent.trim());r=u?u.textContent.trim():d.textContent.trim()}r=r.replace(/\s+/g," ");const p=r.match(/^\(([\d,.\s]+)\)$/);if(p){const u=parseFloat(p[1].replace(/,/g,""));return isNaN(u)?r.toLowerCase():-u}if(/^-?[\d,.]+%$/.test(r)){const u=parseFloat(r.replace("%",""));return isNaN(u)?0:u/100}const I=/^-?[\$€₹]?\s*([\d,.]+)\s*([KMB])?$/i,b=r.match(I);if(b){let u=parseFloat(b[1].replace(/,/g,""));const w=(S=b[2])==null?void 0:S.toUpperCase(),v={K:1e3,M:1e6,B:1e9};if(!isNaN(u))return w&&v[w]&&(u*=v[w]),u}const P=r.match(/^(\d+)(st|nd|rd|th)$/i);if(P)return parseInt(P[1],10);if(/^-?\d+(\.\d+)?$/.test(r)){const u=parseFloat(r);return isNaN(u)?r.toLowerCase():u}const y=new Date(r);return isNaN(y.getTime())?r.toLowerCase():y.getTime()}this.filteredRows.sort((m,l)=>{const i=g(m,a,o),d=g(l,a,o);return typeof i=="number"&&typeof d=="number"?h==="asc"?i-d:d-i:typeof i=="string"&&typeof d=="string"?h==="asc"?i.localeCompare(d):d.localeCompare(i):0}),this.currentPage=1,this.update()})})}deleteSelected(){this.deleteSelectedSelector=this.table.querySelector(this.parentInstance.deleteSelectedSelector),this.deleteSelectedSelector&&this.deleteSelectedSelector.addEventListener("click",t=>{t.preventDefault();const s=this.rows.filter(e=>e.querySelector('input[type="checkbox"]').checked);if(s.length>0){const{modal:e,confirmButton:n}=this.alert(s.length>1?this.deleteMultipleRowsMessage:this.deleteRowMessage),a=this.rows,o=()=>{s.forEach(h=>h.remove());const c=a.filter(h=>!s.includes(h));this.rows=[...c],this.filteredRows=[...c],this.currentPage>this.totalPages&&(this.currentPage=this.totalPages),this.update(),e.hide(),this.deleteSelectedSelector.classList.add("d-none"),this.checkAllCheckBox.checked=!1};e.show(),n.addEventListener("click",o)}})}deleteRow(){const t=this.table.querySelectorAll(this.parentInstance.deleteRowSelector);t&&t.forEach(s=>{s.addEventListener("click",e=>{e.preventDefault();const{modal:n,confirmButton:a}=this.alert(),o=this.rows,c=()=>{const h=s.closest("tr");h.remove();const g=o.filter(m=>m!==h);this.rows=[...g],this.filteredRows=[...g],this.currentPage>this.totalPages&&(this.currentPage=this.totalPages),this.update(),n.hide()};n.show(),a.addEventListener("click",c)})})}alert(t){const s=`
        <div id="confirm-delete-modal" class="modal fade" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Confirm Deletion</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">   
                        <p class="mb-0">${t??this.deleteRowMessage}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                          <button type="button" class="btn btn-danger" id="confirm-delete">Delete</button>
                    </div>
                </div>
            </div>
        </div>`;document.body.insertAdjacentHTML("beforeend",s);const e=document.getElementById("confirm-delete-modal"),n=new bootstrap.Modal(e),a=e.querySelector("#confirm-delete");return{modal:n,confirmButton:a}}}class A{constructor({tableSelector:t="[data-table]",checkAllSelector:s="[data-table-select-all]",searchSelector:e="[data-table-search]",filterSelector:n="select[data-table-filter], input[data-table-filter]",rangeFilterSelector:a="select[data-table-range-filter], input[data-table-range-filter]",rowsPerPageSelector:o="[data-table-set-rows-per-page]",rowsPerPageAttribute:c="data-table-rows-per-page",paginationSelector:h="[data-table-pagination]",sortSelector:g="[data-table-sort]",sortAttribute:m="data-table-sort",paginationInfoSelector:l="[data-table-pagination-info]",paginationInfoAttribute:i="data-table-pagination-info",deleteSelectedSelector:d="[data-table-delete-selected]",deleteRowSelector:r="[data-table-delete-row]",rowsPerPage:p=10,currentPage:f=1}={}){this.tableSelector=t,this.checkAllSelector=s,this.searchSelector=e,this.filterSelector=n,this.rangeFilterSelector=a,this.rowsPerPageSelector=o,this.rowsPerPageAttribute=c,this.paginationSelector=h,this.sortSelector=g,this.sortAttribute=m,this.paginationInfoSelector=l,this.paginationInfoAttribute=i,this.deleteSelectedSelector=d,this.deleteRowSelector=r,this.rowsPerPage=p,this.currentPage=f,this.tables=[],this.init()}init(){document.querySelectorAll(this.tableSelector).forEach(s=>{const e=new k(s,this);this.tables.push(e),e.init()})}}document.addEventListener("DOMContentLoaded",()=>{new A});
